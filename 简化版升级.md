å¼€å§‹
â”œâ”€ æ­¥éª¤0ï¼šå‰ç½®æ£€æŸ¥
â”‚  â”œâ”€ æ£€æŸ¥å·¥ä½œåŒºçŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æœªæäº¤çš„æ›´æ”¹ï¼‰
â”‚  â””â”€ ç¡®è®¤å½“å‰å·¥ä½œç›®å½•æ˜¯å¦ä¸º Git ä»“åº“
â”‚
â”œâ”€ æ­¥éª¤1ï¼šé€‰æ‹©å‡çº§ç¯å¢ƒ
â”‚  â”œâ”€ é€‰é¡¹ï¼štestã€inte
â”‚  â””â”€ æ ¹æ®é€‰æ‹©ç¡®å®šï¼š
â”‚     â”œâ”€ test: ç›®æ ‡åˆ†æ”¯=test-220918, æºåˆ†æ”¯=plus-upgrade-test
â”‚     â””â”€ inte: ç›®æ ‡åˆ†æ”¯=sprint-251225, æºåˆ†æ”¯=plus-upgrade-sprint
â”‚
â”œâ”€ æ­¥éª¤2ï¼šè¾“å…¥ç‰¹æ€§åˆ†æ”¯åç¼€
â”‚  â”œâ”€ æç¤ºï¼šè¯·è¾“å…¥ç‰¹æ€§åˆ†æ”¯åç§°ï¼ˆä¾‹å¦‚ï¼š241219ï¼‰
â”‚  â”œâ”€ è‡ªåŠ¨æ‹¼æ¥å‰ç¼€ï¼š@upgrade/{ç¯å¢ƒ}/
â”‚  â””â”€ ç”Ÿæˆå®Œæ•´åˆ†æ”¯åï¼š@upgrade/test/241219 æˆ– @upgrade/inte/241219
â”‚
â”œâ”€ æ­¥éª¤3ï¼šåˆ‡æ¢å¹¶æ›´æ–°ç›®æ ‡åˆ†æ”¯
â”‚  â”œâ”€ git checkout {ç›®æ ‡åˆ†æ”¯}
â”‚  â””â”€ git pull origin {ç›®æ ‡åˆ†æ”¯}
â”‚
â”œâ”€ æ­¥éª¤4ï¼šåˆ›å»º/åˆ‡æ¢ç‰¹æ€§åˆ†æ”¯
â”‚  â”œâ”€ æ£€æŸ¥ç‰¹æ€§åˆ†æ”¯æ˜¯å¦å­˜åœ¨ï¼šgit rev-parse --verify {ç‰¹æ€§åˆ†æ”¯}
â”‚  â”œâ”€ è‹¥å­˜åœ¨ï¼šgit checkout {ç‰¹æ€§åˆ†æ”¯}
â”‚  â””â”€ è‹¥ä¸å­˜åœ¨ï¼šgit checkout -b {ç‰¹æ€§åˆ†æ”¯} {ç›®æ ‡åˆ†æ”¯}
â”‚
â”œâ”€ æ­¥éª¤5ï¼šåˆå…¥æºä»£ç åˆ†æ”¯
â”‚  â”œâ”€ git pull origin {æºåˆ†æ”¯}
â”‚  â””â”€ æ£€æµ‹å†²çª
â”‚
â”œâ”€ æ­¥éª¤6ï¼šå†²çªå¤„ç†ï¼ˆæš‚åœç‚¹ï¼‰
â”‚  â”œâ”€ è‹¥æœ‰å†²çªï¼šæ‰“å¼€ SCM è§†å›¾
â”‚  â”œâ”€ æç¤ºå†²çªå¤„ç†è§„åˆ™ï¼š
â”‚  â”‚  â”œâ”€ voucherconfig å†²çªï¼šå…ˆä¿ç•™å½“å‰åˆ†æ”¯ç‰ˆæœ¬
â”‚  â”‚  â”œâ”€ bizSchemaManager/bizApplicationï¼šä¼˜å…ˆé‡‡ç”¨å½“å‰åˆ†æ”¯
â”‚  â”‚  â””â”€ å¼•ç”¨å†²çªï¼šå¯¹æ¯”åå–æ–°åˆ†æ”¯
â”‚  â””â”€ ç­‰å¾…ç”¨æˆ·ç‚¹å‡»"ç»§ç»­"
â”‚
â”œâ”€ æ­¥éª¤7ï¼šæ‰§è¡Œå‡çº§è„šæœ¬
â”‚  â””â”€ yarn upgrade
â”‚
â”œâ”€ æ­¥éª¤8ï¼šæ‰§è¡Œå•æµ‹ï¼ˆå¯é€‰ï¼‰
â”‚  â”œâ”€ å¼¹çª—è¯¢é—®ï¼šæ˜¯å¦è¿è¡Œ yarn testï¼Ÿ
â”‚  â”œâ”€ è‹¥é€‰æ‹©è¿è¡Œï¼šæ‰§è¡Œ yarn test
â”‚  â”œâ”€ è‹¥å¤±è´¥ï¼šæç¤ºä¿®å¤å•æµ‹ï¼Œæš‚åœæµç¨‹
â”‚  â””â”€ è‹¥é€‰æ‹©è·³è¿‡ï¼šç»§ç»­æµç¨‹
â”‚
â”œâ”€ æ­¥éª¤9ï¼šæäº¤å¹¶æ¨é€ç‰¹æ€§åˆ†æ”¯
â”‚  â”œâ”€ git add .
â”‚  â”œâ”€ git commit -m "chore: upgrade from {æºåˆ†æ”¯}"
â”‚  â””â”€ git push origin {ç‰¹æ€§åˆ†æ”¯}
â”‚
â”œâ”€ æ­¥éª¤10ï¼šåˆ‡æ¢å›ç›®æ ‡åˆ†æ”¯å¹¶æ›´æ–°
â”‚  â”œâ”€ git checkout {ç›®æ ‡åˆ†æ”¯}
â”‚  â””â”€ git pull origin {ç›®æ ‡åˆ†æ”¯}
â”‚
â”œâ”€ æ­¥éª¤11ï¼šåˆå¹¶ç‰¹æ€§åˆ†æ”¯åˆ°ç›®æ ‡åˆ†æ”¯
â”‚  â”œâ”€ git merge {ç‰¹æ€§åˆ†æ”¯}
â”‚  â””â”€ æ£€æµ‹å†²çªï¼ˆæš‚åœç‚¹ï¼‰
â”‚
â”œâ”€ æ­¥éª¤12ï¼šæ¨é€ç›®æ ‡åˆ†æ”¯
â”‚  â””â”€ git push origin {ç›®æ ‡åˆ†æ”¯}
â”‚
â””â”€ æ­¥éª¤13ï¼šå®Œæˆæç¤º
   â”œâ”€ æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
   â””â”€ æç¤ºåç»­æ“ä½œï¼šéƒ¨ç½²ç¯å¢ƒã€éªŒè¯åŠŸèƒ½


   # æ–°å‘½ä»¤éœ€æ±‚ï¼šbizMigration.quickUpgrade

## å‘½ä»¤æ¦‚è¿°
è¿™æ˜¯ `bizMigration.syncCode` çš„ç²¾ç®€ç‰ˆï¼Œç”¨äºå¿«é€Ÿå‡çº§ test/inte ç¯å¢ƒçš„ä»£ç ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–çš„åˆ†æ”¯ç®¡ç†ã€ä»£ç åˆå¹¶ã€å†²çªå¤„ç†å’Œå•æµ‹éªŒè¯ã€‚

## å®ç°å‚è€ƒ
- äº¤äº’æ–¹å¼å‚è€ƒï¼š`SyncManager.runStandard()` æ–¹æ³•
- æ­¥éª¤ç³»ç»Ÿï¼šä½¿ç”¨ `SyncStep[]` æ•°ç»„å®šä¹‰æµç¨‹
- å†²çªå¤„ç†ï¼šä½¿ç”¨ `runWithConflictSupport()` æ–¹æ³•
- æš‚åœ/ç»§ç»­ï¼šä½¿ç”¨ `waitForContinue()` å’Œ `resolvePending()` æœºåˆ¶

## è¯¦ç»†æµç¨‹æ­¥éª¤

### å‚æ•°æ”¶é›†é˜¶æ®µ

1. **é€‰æ‹©å‡çº§ç¯å¢ƒ**
   - ä½¿ç”¨ `vscode.window.showQuickPick`
   - é€‰é¡¹ï¼š
     - `{ label: 'Test ç¯å¢ƒ', value: 'test' }`
     - `{ label: 'Inte ç¯å¢ƒ', value: 'inte' }`
   - æ ¹æ®é€‰æ‹©ç¡®å®šï¼š
     - test: `targetBranch='test-220918'`, `sourceBranch='plus-upgrade-test'`
     - inte: `targetBranch='sprint-251225'`, `sourceBranch='plus-upgrade-sprint'`

2. **è¾“å…¥ç‰¹æ€§åˆ†æ”¯åç¼€**
   - ä½¿ç”¨ `vscode.window.showInputBox`
   - å‚æ•°ï¼š
     - `placeHolder`: "è¯·è¾“å…¥ç‰¹æ€§åˆ†æ”¯åç¼€ï¼ˆå¦‚ï¼š241219ï¼‰"
     - `value`: å½“å‰æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYMMDDï¼‰
     - `prompt`: "ç‰¹æ€§åˆ†æ”¯å°†è‡ªåŠ¨æ·»åŠ å‰ç¼€ï¼š@upgrade/{ç¯å¢ƒ}/"
   - ç”Ÿæˆå®Œæ•´åˆ†æ”¯åï¼š`featureBranch = @upgrade/${env}/${suffix}`

### æ‰§è¡Œæ­¥éª¤ï¼ˆSyncStep[]ï¼‰

const steps: SyncStep[] = [
  // 0. ä¿¡æ¯å±•ç¤º
  { 
    kind: 'info', 
    title: `å·¥ä½œåŒºï¼š${workspaceRoot}` 
  },
  { 
    kind: 'info', 
    title: `å‡çº§ç¯å¢ƒï¼š${env}`,
    detail: `ç›®æ ‡åˆ†æ”¯ï¼š${targetBranch}, æºåˆ†æ”¯ï¼š${sourceBranch}, ç‰¹æ€§åˆ†æ”¯ï¼š${featureBranch}`
  },
  
  // 1. åˆ‡æ¢å¹¶æ›´æ–°ç›®æ ‡åˆ†æ”¯
  { 
    kind: 'command', 
    title: `åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯ ${targetBranch}`, 
    command: `git checkout ${targetBranch}` 
  },
  { 
    kind: 'command', 
    title: `æ›´æ–° origin/${targetBranch}`, 
    command: `git pull origin ${targetBranch}` 
  },
  
  // 2. åˆ›å»º/åˆ‡æ¢ç‰¹æ€§åˆ†æ”¯
  { 
    kind: 'command', 
    title: `åˆ›å»º/åˆ‡æ¢ç‰¹æ€§åˆ†æ”¯ ${featureBranch}`, 
    command: () => this.checkoutFeature(featureBranch, targetBranch, workspaceRoot) 
  },
  
  // 3. åˆå…¥æºä»£ç åˆ†æ”¯
  { 
    kind: 'command', 
    title: `åˆå…¥æºç åˆ†æ”¯ origin/${sourceBranch}`, 
    command: () => this.runWithConflictSupport(`git pull origin ${sourceBranch}`, workspaceRoot, true) 
  },
  
  // 4. å†²çªå¤„ç†æš‚åœç‚¹
  { 
    kind: 'pause', 
    title: 'å¤„ç†ä»£ç åˆå¹¶å†²çª', 
    detail: `å†²çªå¤„ç†è§„åˆ™ï¼š
(1) voucherconfig å†²çªï¼šå…ˆä¿ç•™å½“å‰åˆ†æ”¯ç‰ˆæœ¬ï¼Œä¹‹åå†è¦†ç›–
(2) bizSchemaManager/bizApplicationï¼šä¼˜å…ˆé‡‡ç”¨å½“å‰åˆ†æ”¯
(3) å¼•ç”¨å†²çªï¼šå¯¹æ¯”åæŒ‰éœ€å–æ–°åˆ†æ”¯
(4) å®Œæˆåç‚¹å‡»"ç»§ç»­"`, 
    command: () => this.openConflictResolver() 
  },
  
  // 5. æ‰§è¡Œå‡çº§è„šæœ¬
  { 
    kind: 'command', 
    title: 'æ‰§è¡Œå‡çº§è„šæœ¬ yarn upgrade', 
    command: 'yarn upgrade' 
  },
  
  // 6. è¿è¡Œå•æµ‹ï¼ˆå¯é€‰ï¼‰
  { 
    kind: 'command', 
    title: 'è¿è¡Œå•æµ‹ yarn testï¼ˆå¯åœ¨å¼¹çª—é€‰æ‹©è·³è¿‡ï¼‰', 
    command: () => this.runOptionalTest(workspaceRoot) 
  },
  
  // 7. æäº¤ç‰¹æ€§åˆ†æ”¯ä»£ç 
  { 
    kind: 'command', 
    title: 'æäº¤å‡çº§å˜æ›´', 
    command: `git add . && git commit -m "chore: upgrade from ${sourceBranch}"` 
  },
  
  // 8. æ¨é€ç‰¹æ€§åˆ†æ”¯
  { 
    kind: 'command', 
    title: `æ¨é€ç‰¹æ€§åˆ†æ”¯åˆ° origin/${featureBranch}`, 
    command: `git push origin ${featureBranch}` 
  },
  
  // 9. åˆ‡å›ç›®æ ‡åˆ†æ”¯
  { 
    kind: 'command', 
    title: `åˆ‡å›ç›®æ ‡åˆ†æ”¯ ${targetBranch}`, 
    command: `git checkout ${targetBranch}` 
  },
  
  // 10. æ›´æ–°ç›®æ ‡åˆ†æ”¯
  { 
    kind: 'command', 
    title: `æ›´æ–° origin/${targetBranch}`, 
    command: `git pull origin ${targetBranch}` 
  },
  
  // 11. åˆå¹¶ç‰¹æ€§åˆ†æ”¯åˆ°ç›®æ ‡åˆ†æ”¯
  { 
    kind: 'command', 
    title: `åˆå¹¶ ${featureBranch} åˆ° ${targetBranch}`, 
    command: () => this.runWithConflictSupport(`git merge ${featureBranch}`, workspaceRoot, true) 
  },
  
  // 12. æ¨é€ç›®æ ‡åˆ†æ”¯
  { 
    kind: 'command', 
    title: `æ¨é€ ${targetBranch} åˆ° origin`, 
    command: `git push origin ${targetBranch}` 
  },
  
  // 13. å®Œæˆ
  { 
    kind: 'pause', 
    title: 'ğŸ‰ å¿«é€Ÿå‡çº§æµç¨‹å®Œæˆ', 
    detail: `åç»­æ“ä½œï¼š
1. éƒ¨ç½² ${env === 'test' ? 'pre-test' : 'pre-inte'} ç¯å¢ƒ
2. è¿›è¡ŒåŠŸèƒ½éªŒè¯
3. è§‚å¯Ÿçº¿ä¸Šæ—¥å¿—` 
  },
];## å‘½ä»¤æ³¨å†Œ

åœ¨ `Main.ts` ä¸­æ·»åŠ ï¼š

context.subscriptions.push(
  vscode.commands.registerCommand('bizMigration.quickUpgrade', async () => {
    const workspaceFolders = vscode.workspace.workspaceFolders;
    if (!workspaceFolders || workspaceFolders.length === 0) {
      vscode.window.showErrorMessage('è¯·å…ˆæ‰“å¼€å·¥ä½œåŒºã€‚');
      return;
    }

    let workspaceRoot = workspaceFolders[0].uri.fsPath;
    if (workspaceFolders.length > 1) {
      const pick = await vscode.window.showQuickPick(
        workspaceFolders.map(f => ({
          label: f.name,
          description: f.uri.fsPath,
          value: f.uri.fsPath,
        })),
        { placeHolder: 'é€‰æ‹©è¦æ‰§è¡Œå‡çº§çš„å·¥ä½œåŒºç›®å½•' }
      );
      if (!pick) return;
      workspaceRoot = pick.value;
    }

    await syncManager.runQuickUpgrade(workspaceRoot);
  })
);## SyncManager æ–°å¢æ–¹æ³•

åœ¨ `SyncManager.ts` ä¸­æ·»åŠ  `runQuickUpgrade()` æ–¹æ³•ï¼Œå®ç°ä¸Šè¿°æ­¥éª¤ã€‚

## é”™è¯¯å¤„ç†

- Git å‘½ä»¤å¤±è´¥ï¼šä½¿ç”¨ `execLogged()` è‡ªåŠ¨è®°å½•åˆ° Output Channel
- å†²çªæ£€æµ‹ï¼šä½¿ç”¨ `runWithConflictSupport()` è‡ªåŠ¨æš‚åœæµç¨‹
- ç”¨æˆ·å–æ¶ˆï¼šæ•è· token.isCancellationRequested
- å•æµ‹å¤±è´¥ï¼šæä¾›æš‚åœå’Œç»§ç»­é€‰é¡¹

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–

1. æ‰€æœ‰ Git æ“ä½œè¾“å‡ºåˆ° Output Channel
2. è¿›åº¦æ¡æ˜¾ç¤ºå½“å‰æ­¥éª¤
3. å†²çªæ—¶è‡ªåŠ¨æ‰“å¼€ SCM è§†å›¾
4. çŠ¶æ€æ æ˜¾ç¤ºæš‚åœçŠ¶æ€
5. å®Œæˆåæ˜¾ç¤ºåç»­æ“ä½œå»ºè®®