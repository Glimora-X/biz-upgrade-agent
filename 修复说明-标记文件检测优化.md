# ä¿®å¤è¯´æ˜ - æ ‡è®°æ–‡ä»¶æ£€æµ‹ä¼˜åŒ–

## ğŸ› é—®é¢˜

å‡çº§è„šæœ¬æ‰§è¡Œå®Œæˆäº†ï¼Œä½†æ˜¯æ²¡æœ‰è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥ã€‚

## ğŸ” é—®é¢˜åŸå› 

### åŸå› åˆ†æ

```typescript
// é—®é¢˜ä»£ç 
terminal.sendText(command);                          // ç¬¬ä¸€æ¬¡è°ƒç”¨
terminal.sendText('if [ $? -eq 0 ]; then ...');    // ç¬¬äºŒæ¬¡è°ƒç”¨
```

**é—®é¢˜**ï¼š
1. `terminal.sendText()` æ˜¯å¼‚æ­¥çš„
2. ä¸¤æ¬¡è°ƒç”¨ä¹‹é—´ï¼Œ`$?` å¯èƒ½ä¸æ˜¯ç¬¬ä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºç 
3. ä¸¤ä¸ªå‘½ä»¤å¯èƒ½è¢«åˆå¹¶æˆ–åˆ†å¼€æ‰§è¡Œï¼Œå¯¼è‡´ `$?` è·å–é”™è¯¯

### å…·ä½“è¡¨ç°

```bash
# é¢„æœŸçš„æ‰§è¡Œ
node ./scripts/upgrade-bizcore.js   # é€€å‡ºç  0
if [ $? -eq 0 ]; then ...           # $? = 0ï¼Œåˆ›å»ºæˆåŠŸæ ‡è®°

# å®é™…å¯èƒ½çš„æ‰§è¡Œ
node ./scripts/upgrade-bizcore.js   # é€€å‡ºç  0
# ... ä¸­é—´å¯èƒ½æœ‰å…¶ä»–æ“ä½œ ...
if [ $? -eq 0 ]; then ...           # $? å¯èƒ½ä¸æ˜¯ 0ï¼Œæ— æ³•åˆ›å»ºæ ‡è®°
```

## âœ… è§£å†³æ–¹æ¡ˆ

### åˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤

å°†å‘½ä»¤å’Œæ ‡è®°æ–‡ä»¶åˆ›å»ºåˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤ï¼Œç¡®ä¿ `$?` è·å–çš„æ˜¯æ­£ç¡®çš„é€€å‡ºç ï¼š

```typescript
// ä¿®å¤åçš„ä»£ç 
const fullCommand = `${command}; if [ $? -eq 0 ]; then touch ${successMarker}; else touch ${failMarker}; fi`;
terminal.sendText(fullCommand);
```

### å·¥ä½œåŸç†

```bash
# å®Œæ•´å‘½ä»¤
node ./scripts/upgrade-bizcore.js; if [ $? -eq 0 ]; then touch .upgrade-marker-xxx-success; else touch .upgrade-marker-xxx-fail; fi

# æ‰§è¡Œæµç¨‹
1. æ‰§è¡Œ node ./scripts/upgrade-bizcore.js
2. ç«‹å³æ£€æŸ¥ $? (å‰ä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºç )
3. å¦‚æœ $? = 0ï¼Œåˆ›å»ºæˆåŠŸæ ‡è®°
4. å¦‚æœ $? â‰  0ï¼Œåˆ›å»ºå¤±è´¥æ ‡è®°
```

## ğŸ”§ ä¼˜åŒ–å†…å®¹

### 1. åˆå¹¶å‘½ä»¤

```typescript
// ä¼˜åŒ–å‰
terminal.sendText(command);
terminal.sendText(`if [ $? -eq 0 ]; then touch ${successMarker}; else touch ${failMarker}; fi`);

// ä¼˜åŒ–å
const fullCommand = `${command}; if [ $? -eq 0 ]; then touch ${successMarker}; else touch ${failMarker}; fi`;
terminal.sendText(fullCommand);
```

### 2. æ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
// è¾“å‡ºæ ‡è®°æ–‡ä»¶å
this.output.appendLine(`ğŸ” æˆåŠŸæ ‡è®°: ${successMarker}`);
this.output.appendLine(`ğŸ” å¤±è´¥æ ‡è®°: ${failMarker}`);

// æ£€æµ‹è¿‡ç¨‹æ—¥å¿—ï¼ˆæ¯ 10 ç§’ï¼‰
if (checkCount % 20 === 0) {
  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  this.output.appendLine(`â³ ç­‰å¾…ä¸­... (å·²ç­‰å¾… ${elapsed} ç§’ï¼Œæ£€æŸ¥æ ‡è®°æ–‡ä»¶: ${successMarker})`);
}

// æ£€æµ‹åˆ°å®Œæˆ
this.output.appendLine(`âœ… æ£€æµ‹åˆ°å‘½ä»¤æ‰§è¡Œå®Œæˆ`);
```

### 3. è°ƒæ•´ä»£ç é¡ºåº

ä¿®å¤å˜é‡å£°æ˜é¡ºåºé—®é¢˜ï¼Œç¡®ä¿åœ¨ä½¿ç”¨å‰å…ˆå£°æ˜ï¼š

```typescript
// 1. å…ˆå£°æ˜å˜é‡
const marker = `.upgrade-marker-${Date.now()}`;
const successMarker = `${marker}-success`;
const failMarker = `${marker}-fail`;

// 2. å†ä½¿ç”¨å˜é‡
this.output.appendLine(`ğŸ” æˆåŠŸæ ‡è®°: ${successMarker}`);
```

## ğŸ“Š ä¿®å¤å¯¹æ¯”

### ä¿®å¤å‰

```
æ‰§è¡Œå‘½ä»¤
  â†“
ç­‰å¾…...ç­‰å¾…...ç­‰å¾…...
  â†“
è¶…æ—¶ï¼ˆ30åˆ†é’Ÿï¼‰âŒ
æˆ–
æ°¸è¿œç­‰å¾… â°
```

### ä¿®å¤å

```
æ‰§è¡Œå‘½ä»¤
  â†“
å‘½ä»¤æ‰§è¡Œä¸­ï¼ˆç»ˆç«¯æ˜¾ç¤ºå½©è‰²è¾“å‡ºï¼‰
  â†“
å‘½ä»¤å®Œæˆ
  â†“
åˆ›å»ºæ ‡è®°æ–‡ä»¶ âœ“
  â†“
æ£€æµ‹åˆ°æ ‡è®°æ–‡ä»¶ âœ“
  â†“
è‡ªåŠ¨ç»§ç»­ä¸‹ä¸€æ­¥ âœ…
```

## ğŸ¯ è¾“å‡ºç¤ºä¾‹

### å¼€å§‹æ‰§è¡Œ

```
============================================================
âš™ï¸  æ‰§è¡Œå‘½ä»¤: node ./scripts/upgrade-bizcore.js
ğŸ“º ç»ˆç«¯åç§°: Biz Upgrade: å‡çº§è„šæœ¬
ğŸ“ å·¥ä½œç›®å½•: /Users/xxx/project
ğŸ• å¼€å§‹æ—¶é—´: 14:30:15
ğŸ” æˆåŠŸæ ‡è®°: .upgrade-marker-1734595815123-success
ğŸ” å¤±è´¥æ ‡è®°: .upgrade-marker-1734595815123-fail
============================================================

ğŸ‘‰ å‘½ä»¤æ­£åœ¨é›†æˆç»ˆç«¯ä¸­è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°å®Œæ•´çš„å½©è‰²è¾“å‡º
ğŸ‘‰ å‘½ä»¤å®Œæˆåä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ç»§ç»­ä¸‹ä¸€æ­¥
ğŸ‘‰ æ­£åœ¨ç­‰å¾…å‘½ä»¤å®Œæˆ...
```

### æ£€æµ‹è¿‡ç¨‹ï¼ˆæ¯ 10 ç§’è¾“å‡ºï¼‰

```
â³ ç­‰å¾…ä¸­... (å·²ç­‰å¾… 10 ç§’ï¼Œæ£€æŸ¥æ ‡è®°æ–‡ä»¶: .upgrade-marker-1734595815123-success)
â³ ç­‰å¾…ä¸­... (å·²ç­‰å¾… 20 ç§’ï¼Œæ£€æŸ¥æ ‡è®°æ–‡ä»¶: .upgrade-marker-1734595815123-success)
â³ ç­‰å¾…ä¸­... (å·²ç­‰å¾… 30 ç§’ï¼Œæ£€æŸ¥æ ‡è®°æ–‡ä»¶: .upgrade-marker-1734595815123-success)
```

### å®Œæˆæ£€æµ‹

```
============================================================
âœ… æ£€æµ‹åˆ°å‘½ä»¤æ‰§è¡Œå®Œæˆ
â±ï¸  è€—æ—¶: 2 åˆ† 15 ç§’
ğŸ• å®Œæˆæ—¶é—´: 14:32:30
============================================================

â„¹ï¸ å‡çº§è„šæœ¬ æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶ 2 åˆ† 15 ç§’
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **é‡æ–°åŠ è½½çª—å£**
   ```
   Cmd+Shift+P â†’ Reload Window
   ```

2. **è¿è¡Œå¿«é€Ÿå‡çº§**
   ```
   Cmd+Shift+P â†’ Biz Migration: å¿«é€Ÿå‡çº§ï¼ˆTest/Inte ç¯å¢ƒï¼‰
   ```

3. **è§‚å¯Ÿæ‰§è¡Œè¿‡ç¨‹**
   - âœ… ç»ˆç«¯æ‰“å¼€å¹¶æ˜¾ç¤ºå½©è‰²è¾“å‡º
   - âœ… è¾“å‡ºé¢‘é“æ˜¾ç¤ºæ ‡è®°æ–‡ä»¶å
   - âœ… æ¯ 10 ç§’æ˜¾ç¤ºç­‰å¾…æ—¥å¿—
   - âœ… å‘½ä»¤å®Œæˆåè‡ªåŠ¨æ£€æµ‹
   - âœ… è‡ªåŠ¨ç»§ç»­ä¸‹ä¸€æ­¥

4. **æŸ¥çœ‹ç»ˆç«¯ï¼ˆéªŒè¯æ ‡è®°æ–‡ä»¶ï¼‰**
   - å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰‹åŠ¨æ‰§è¡Œ `ls -la .upgrade-marker*`
   - åº”è¯¥çœ‹ä¸åˆ°æ ‡è®°æ–‡ä»¶ï¼ˆå› ä¸ºå·²æ¸…ç†ï¼‰

### é¢„æœŸç»“æœ

```
âœ… å‘½ä»¤åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼Œæ˜¾ç¤ºå½©è‰²è¾“å‡º
âœ… è¾“å‡ºé¢‘é“è®°å½•è¯¦ç»†æ—¥å¿—
âœ… æ¯ 10 ç§’è¾“å‡ºç­‰å¾…çŠ¶æ€
âœ… å‘½ä»¤å®Œæˆåç«‹å³æ£€æµ‹åˆ°æ ‡è®°æ–‡ä»¶
âœ… è‡ªåŠ¨æ¸…ç†æ ‡è®°æ–‡ä»¶
âœ… è‡ªåŠ¨ç»§ç»­ä¸‹ä¸€æ­¥
```

## ğŸ’¡ è°ƒè¯•æŠ€å·§

### å¦‚æœä»ç„¶æ— æ³•è‡ªåŠ¨ç»§ç»­

1. **æ£€æŸ¥æ ‡è®°æ–‡ä»¶æ˜¯å¦åˆ›å»º**
   ```bash
   # åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ
   ls -la | grep upgrade-marker
   ```

2. **æŸ¥çœ‹è¾“å‡ºé¢‘é“**
   - æ‰“å¼€è¾“å‡ºé¢æ¿ï¼š`Cmd+Shift+U`
   - é€‰æ‹© "Biz Quick Upgrade"
   - æŸ¥çœ‹æ ‡è®°æ–‡ä»¶åå’Œæ£€æµ‹æ—¥å¿—

3. **æ‰‹åŠ¨åˆ›å»ºæ ‡è®°æ–‡ä»¶æµ‹è¯•**
   ```bash
   # åœ¨é¡¹ç›®ç›®å½•åˆ›å»ºæˆåŠŸæ ‡è®°
   touch .upgrade-marker-test-success
   
   # è§‚å¯Ÿæ˜¯å¦è¢«æ£€æµ‹åˆ°
   ```

4. **æ£€æŸ¥æ–‡ä»¶æƒé™**
   ```bash
   # ç¡®ä¿æœ‰åˆ›å»ºæ–‡ä»¶çš„æƒé™
   touch .test-file
   rm .test-file
   ```

## ğŸ“ å…³é”®æ”¹è¿›ç‚¹

### 1. å‘½ä»¤åˆå¹¶ âœ…

```typescript
// ç¡®ä¿ $? è·å–æ­£ç¡®çš„é€€å‡ºç 
const fullCommand = `${command}; if [ $? -eq 0 ]; then touch ${successMarker}; else touch ${failMarker}; fi`;
```

### 2. è°ƒè¯•æ—¥å¿— âœ…

```typescript
// æ˜¾ç¤ºæ ‡è®°æ–‡ä»¶å
this.output.appendLine(`ğŸ” æˆåŠŸæ ‡è®°: ${successMarker}`);

// æ˜¾ç¤ºæ£€æµ‹è¿›åº¦
this.output.appendLine(`â³ ç­‰å¾…ä¸­... (å·²ç­‰å¾… ${elapsed} ç§’)`);

// æ˜¾ç¤ºæ£€æµ‹ç»“æœ
this.output.appendLine(`âœ… æ£€æµ‹åˆ°å‘½ä»¤æ‰§è¡Œå®Œæˆ`);
```

### 3. ä»£ç ä¼˜åŒ– âœ…

```typescript
// å˜é‡å£°æ˜é¡ºåºæ­£ç¡®
const marker = ...;
const successMarker = ...;
// ç„¶åæ‰ä½¿ç”¨
```

## âœ… ä¿®å¤æ¸…å•

- [x] âœ… åˆå¹¶å‘½ä»¤ï¼Œç¡®ä¿ `$?` æ­£ç¡®
- [x] âœ… æ·»åŠ æ ‡è®°æ–‡ä»¶åè¾“å‡º
- [x] âœ… æ·»åŠ æ£€æµ‹è¿›åº¦æ—¥å¿—
- [x] âœ… è°ƒæ•´å˜é‡å£°æ˜é¡ºåº
- [x] âœ… ä¼˜åŒ–æ£€æµ‹å®Œæˆæç¤º
- [x] âœ… ç¼–è¯‘é€šè¿‡
- [x] âœ… ä¿®å¤è¯´æ˜æ–‡æ¡£

## ğŸ‰ å®Œæˆ

ç°åœ¨å‡çº§è„šæœ¬åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æ­£ç¡®åˆ›å»ºæ ‡è®°æ–‡ä»¶
- âœ… å‡†ç¡®æ£€æµ‹å‘½ä»¤å®Œæˆ
- âœ… è‡ªåŠ¨ç»§ç»­ä¸‹ä¸€æ­¥
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

**è¯·é‡æ–°åŠ è½½çª—å£å¹¶æµ‹è¯•ï¼** ğŸš€

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¾“å‡ºé¢‘é“çš„è°ƒè¯•æ—¥å¿—ï¼Œé‡Œé¢ä¼šæ˜¾ç¤ºæ ‡è®°æ–‡ä»¶åå’Œæ£€æµ‹è¿‡ç¨‹ã€‚

---

*ä¿®å¤æ—¶é—´: 2024-12-19*
*é—®é¢˜: æ ‡è®°æ–‡ä»¶æ£€æµ‹å¤±è´¥*
*è§£å†³: åˆå¹¶å‘½ä»¤ + è°ƒè¯•æ—¥å¿—*

