# ============================================

# app-service 仓库

# ============================================

# 添加远程仓库

git remote add plus https://gitlab.rd.chanjet.com/cc_web/cc-front-biz-app-service-plus

git remote -v

# 切换到 test-220915 分支

git checkout test-220915

# 拉取代码 并记录

git pull origin test-220915

# 推送到 plus 仓库 feat-test-250918 分支、避免直接覆盖 plus 的 test-220915 分支

git push plus test-220915:feat-test-250918

# ============================================

# 在 app-service-plus 仓库通过 merge request/pull request 来合并代码

# ============================================

#切换到 feat-test-250918 分支
git checkout feat-test-250918
git pull origin feat-test-250918 拉完代码就结束
【feat-test-250918 这个分支只做数据同步 和源码一致】

1. 只是正常同步代码【没有脚本变更、没有大量的 voucherconfig 文件修正、或者结构目录调整】

# 从 test-220918 拉一个特性分支来做升级，如 feature/upgrade-test-251218

git checkout test-220918
git pull
git checkout -b feature/upgrade-test-251218

# 拉一下源码分支

git pull origin feat-test-250918

# 解决冲突

- 遇见 voucherconfig 文件 先采用当前分支，然后将源码 copy 出来，后续通过脚本升级
- 遇见新写法的冲突一般采用当前，如带有 bizSchemaManager、bizApplication
- 出现引用冲突的可以使用 做简单对比 一般可以先采用新分支的，后续通过脚本升级

# 进行脚本升级

yarn upgrade

# 进行单测修复

yarn test

# 提交代码 g

git push origin feature/upgrade-test-251218

# 最后再合并到 test-220915 分支

git merge feature/upgrade-test-251218
git push

2.脚本变更、大量的 voucherconfig 文件修正、结构目录调整等需要重建分支时

# 依据 feat-test-250918 拉一个特性分支进行代码升级 如 feature/upgrade-test-25**新**

# 进行脚本升级 yarn upgrade --commit 【commit 会把每类脚本单独提交 方便回滚】

# 将 feature/upgrade-test-25**新** merge 上一次的 feature/upgrade-test-25**旧**[--no--verify]

# 进行单测修复

# 进行本地测试 并记录

# 最后再合并到 plus 仓库的 test-220915 分支 合并代码 并记录

git checkout test-220915
git merge origin feature/upgrade-test-25**新**

# 流程图
启动 syncCode
 └─ 选择模式：
     ├─ 源仓库：仅推送到 plus（sourcePush, app-service）
     │   ├─ 远程名：可填，默认 plus
     │   ├─ 基线分支：默认 test-220915
     │   ├─ 目标分支：默认 feat-test-250918（记入 lastSourceTargetBranch）
     │   ├─ fetch origin
     │   ├─ checkout/pull 基线
     │   ├─ push 基线 → plus/目标分支
     │   └─ 暂停：提示切到目标仓库 → 在当前窗口弹出工作区选择器
     │       └─ 选目标模式（常规/重建）并在目标仓库继续
     │
     ├─ 目标仓库：常规同步（standard, app-service-plus）
     │   ├─ 远程名：固定 origin
     │   ├─ 基线分支：默认 test-220915
     │   ├─ 源码分支：默认取 lastSourceTargetBranch（若无则 feat-test-250918）
     │   ├─ 特性分支：默认 feature/upgrade-test-YYMMDD
     │   ├─ fetch origin & fetch origin（双拉）
     │   ├─ checkout/pull 基线
     │   ├─ push 基线 → origin/remoteTargetBranch(=源码分支)
     │   ├─ checkout/创建特性分支
     │   ├─ pull 源码分支
     │   ├─ 暂停：人工处理冲突
     │   ├─ yarn upgrade
     │   ├─ 可选：yarn test
     │   ├─ push 特性分支 → origin
     │   ├─ checkout 基线
     │   ├─ merge 特性分支 → push origin
     │   ├─ push 基线 → 远程（origin/base）
     │   └─ 暂停：流程完成
     │
     └─ 目标仓库：重建分支（rebuild, app-service-plus）
         ├─ 远程名：固定 origin
         ├─ 基线分支：默认取 lastSourceTargetBranch（若无则 feat-test-250918）
         ├─ 新分支：默认 feature/upgrade-YYMMDD
         ├─ 上一版分支：可空
         ├─ 最终合入分支：默认 test-220915
         ├─ fetch origin & fetch origin（双拉）
         ├─ checkout/pull 基线
         ├─ push 基线 → origin/base
         ├─ checkout/创建新分支
         ├─ yarn upgrade --commit
         ├─ 可选：merge 上一版分支 --no-verify
         ├─ 暂停：人工处理冲突
         ├─ 可选：yarn test
         ├─ push 新分支 → origin
         ├─ checkout 最终分支 → pull
         ├─ merge 新分支 → push origin
         ├─ push 最终分支 → 远程（origin/final）
         └─ 暂停：流程完成
